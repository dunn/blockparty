---
language: node_js
node_js:
  - "6"

env:
  global:
    - PATH=$HOME/.roswell/bin:$PATH
  matrix:
    - LISP=ccl
    # TODO: get CMUCL to find OpenSSL
    # - LISP=cmucl
    - LISP=ecl
    - LISP=sbcl

services:
  - redis-server

before_install:
  - npm install
  - sudo apt-get -qq update;
  - sudo apt-get install -y libssl-dev;
  - bash "$TRAVIS_BUILD_DIR/scripts/ci.sh"
  - export LISP=ros;

before_script:
  - mv config/oauth.yml.template config/oauth.yml
  - make ql
  - make dist-install
  - nohup make server &

script:
  - make tests
  - cat nohup.out
  - curl -IL localhost:3000
  - cat log/access.log
  - npm test

notifications:
  email: false
